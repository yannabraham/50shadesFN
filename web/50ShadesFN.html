<html>
  <meta charset="UTF-8">

  <script src="d3/d3.min.js"></script>
  <script src="d3/topojson.v1.min.js"></script>
  <script src="http://d3js.org/queue.v1.min.js"></script>

  <style>
    .subunit {
      fill: blue;
    }
  </style>

  <title>50 Nuances de FN</title>

  <body>
  </body>

  <script>
    var width = 960,
        height = 960;

    var annee = "1992";

    var svg = d3.select('body').append('svg')
                .attr('width',width)
                .attr('height',height);

    queue()
      .defer(d3.json,'departements.json')
      .defer(d3.json,'resultats.json')
      .await(draw);

    function draw(error,departements,resultats) {
      if(error) return console.error(error);

      var annees = Object.keys(resultats);

      var subunits = topojson.feature(departements,departements.objects["departements-20140306-100m"]);

      var projection = d3.geo.albers()
                         .center([0, 46])
                         .rotate([-5, 0])
                         .parallels([41, 51])
                         .scale(4000)
                         .translate([width/2,height/2]);

      var path = d3.geo.path().projection(projection);

      var dAnnee = svg.append('text')
        .attr('x',315)
        .attr('y',75)
        .style('font-size','300%');

      svg.append('path')
         .datum(subunits)
         .attr('d',path);

      // create a color scale
      var fnScale = d3.scale.linear().domain([0,1]).range(['white','blue']);

      //var test = topojson.feature(departements, departements.objects["departements-20140306-100m"]).features[0].properties.code_insee;
      //console.log(resultats[test][annee])

      svg.selectAll(".subunit")
         .data(topojson.feature(departements, departements.objects["departements-20140306-100m"]).features)
         .enter().append("path")
            .attr("class", function(d) { return "subunit " + d.id; })
            .attr("d", path)
            .style('fill',function(d) { if(resultats[annee].hasOwnProperty(d.properties.code_insee))
                                          { return(fnScale(resultats[annee][d.properties.code_insee])); }
                                          else { return('grey'); }
                                      });
      dAnnee.text(annee);
    }
  </script>

</html>
